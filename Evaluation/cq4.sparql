# What are the transportation options to reach a specific sports venue in Trentino?

PREFIX etype: <http://knowdive.disi.unitn.it/etype#>
PREFIX schema: <https://schema.org/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT ?facility ?stop ?address WHERE {
    ?facility a etype:facilities_GID-13002 .
    ?facility etype:latitude_GID-46263 ?flat .
    ?facility etype:longitude_GID-46270 ?flon .
    ?facility etype:name_GID-2 ?name .
    ?stop a etype:stop_GID-46571 .
    ?stop etype:latitude_GID-46263 ?slat .
    ?stop etype:longitude_GID-46270 ?slon .

    FILTER(?name = "FACILITY_NAME")

    # Constants for the Haversine formula
    BIND(6371 AS ?earthRadius) # Earth's radius in kilometers
    BIND(PI() AS ?pi)
    BIND(?pi / 180 AS ?deg2rad)
    BIND(<near_threshold> AS ?threshold)

    # Convert degrees to radians
    BIND(?flat * ?deg2rad AS ?latRad)
    BIND(?flon * ?deg2rad AS ?longRad)
    BIND(?slat * ?deg2rad AS ?stopLatRad)
    BIND(?slon * ?deg2rad AS ?stopLongRad)

    # Haversine formula
    BIND(SIN((?latRad - ?stopLatRad) / 2) * SIN((?latRad - ?stopLatRad) / 2) + COS(?stopLatRad) * COS(?latRad) * SIN((?longRad - ?stopLongRad) / 2) * SIN((?longRad - ?stopLongRad) / 2) AS ?a)
    BIND(2 * ATAN2(SQRT(?a), SQRT(1 - ?a)) AS ?c)
    BIND(?earthRadius * ?c AS ?distance)

    FILTER(?distance < ?threshold)
}